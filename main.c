// Клиентская часть
#include <stdio.h>
#include <stdlib.h>
#include <string.h>
#include <sys/socket.h>
#include <netinet/in.h>
#include <arpa/inet.h>

#define PORT 5555
#define MAXBUF 1024

// Главная функция клиента
int main() {
    int sockfd; // дескриптор сокета
    struct sockaddr_in servaddr; // структура адреса сервера
    char buffer[MAXBUF]; // буфер для приема и отправки данных

    // Создаем сокет с протоколом UDP
    sockfd = socket(AF_INET, SOCK_DGRAM, 0);

    // Заполняем структуру адреса сервера
    servaddr.sin_family = AF_INET; // семейство адресов IPv4
    servaddr.sin_addr.s_addr = inet_addr(
            "127.0.0.1"); // адрес сервера (локальный)
    servaddr.sin_port = htons(PORT); // порт

    while (1) {
        printf("Введите количество коэффициентов уравнения (3 или 4): ");
        fgets(buffer, MAXBUF,
              stdin); // считываем количество коэффициентов с клавиатуры

        int n; // количество коэффициентов уравнения
        sscanf(buffer,
               "%d",
               &n); // преобразуем строку в число

        if (n == 3) { // квадратное уравнение
            double a, b,
                    c; // коэффициенты уравнения
            printf("Введите коэффициенты квадратного уравнения (ax^2+bx+c=0), не равные нулю или единице: ");
            scanf("%lf %lf %lf", &a,
                  &b,
                  &c); // считываем коэффициенты с клавиатуры

            if (a == 0 || a == 1 || b == 0 || b == 1 || c == 0 || c == 1) {
                printf("Неверные коэффициенты.\n"); // проверяем, что коэффициенты не равны нулю или единице
                continue; // повторяем ввод
            }

            sprintf(buffer, "%d %lf %lf %lf", n, a, b,
                    c); // форматируем строку с данными для отправки серверу
        } else if (n == 4) { // кубическое уравнение
            double a, b, c,
                    d; // коэффициенты уравнения
            printf("Введите коэффициенты кубического уравнения (ax^3+bx^2+cx+d=0), не равные нулю или единице: ");
            scanf("%lf %lf %lf %lf", &a, &b, &c,
                  &d); // считываем коэффициенты с клавиатуры

            if (a == 0 || a == 1 || b == 0 || b == 1 || c == 0 || c == 1 ||
                d == 0 ||
                d == 1) {
                printf("Неверные коэффициенты.\n"); // проверяем, что коэффициенты не равны нулю или единице
                continue; // повторяем ввод
            }

            sprintf(buffer, "%d %lf %lf %lf %lf", n, a, b, c,
                    d); // форматируем строку с данными для отправки серверу
        } else {
            printf("Неверное количество коэффициентов.\n"); // проверяем, что количество коэффициентов равно 3 или 4
            continue; // повторяем ввод
        }

        // Отправляем данные серверу
        sendto(sockfd, buffer, strlen(buffer), 0,
               (struct sockaddr *) &servaddr,
               sizeof(servaddr)); // отправляем данные серверу

        printf("Отправлен запрос: %s\n",
               buffer); // выводим отправленные данные

        // Принимаем ответ от сервера
        recvfrom(sockfd, buffer, MAXBUF, 0,
                 NULL,
                 NULL); // получаем ответ от сервера

        printf("Получен ответ: %s\n",
               buffer); // выводим полученный ответ

        break; // завершаем цикл
    }

    return 0;
}
